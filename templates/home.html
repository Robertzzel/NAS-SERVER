{{define "title"}}Login{{end}}

{{define "header"}}
<link href="/static/home.css" rel="stylesheet" >
{{end}}

{{define "content"}}
<div class="container-fluid">
    <div class="d-flex flex-row">
        <p class="w-25" id="currentPath">{{.CurrentPath}}</p>
        <div class="w-25" id="back-btn">

        </div>
        <input class="w-25" id="filter">
        <select id="sortingSelect" class="w-25">
            <option value="1">Name ascending</option>
            <option value="2">Name descending</option>
            <option value="3">Created ascending</option>
            <option value="4" selected="selected">Created descending</option>
        </select>
    </div>
    <div id="root" class="row"></div>
</div>

<script>
    const root = document.getElementById("root");
    const filter = document.getElementById("filter");
    const select = document.getElementById("sortingSelect");
    const currentPath = document.getElementById("currentPath").innerText;
    document.getElementById("back-btn").innerHTML = `<a class="w-25 btn btn-primary" type="button" href="/home/${currentPath.split("/").slice(0, -1).join("/")}">BACK</a>`;
    const files = JSON.parse('{{.Files}}');
    displayFiles(true, select.value);

    function displayFiles(filterByInput, sort) {
        let displayedFiles = files;

        if(filterByInput === true) {
            displayedFiles = displayedFiles.filter(it => it.Name.includes(filter.value));
        }

        switch (sort) {
            case "1": // Name ascending
                displayedFiles = displayedFiles.slice().sort((a, b) => a.Name.localeCompare(b.Name));
                break;
            case "2": // Name descending
                displayedFiles = displayedFiles.slice().sort((a, b) => b.Name.localeCompare(a.Name));
                break;
            case "3": // Created ascending
                displayedFiles = displayedFiles.slice().sort((a, b) => a.CreatingTime - b.CreatingTime);
                break;
            case "4": // Created descending
                displayedFiles = displayedFiles.slice().sort((a, b) => b.CreatingTime - a.CreatingTime);
                break;
            default:
        }

        let htmlContent = ""
        for(let i = 0; i < displayedFiles.length; i++) {
            const elem = displayedFiles[i];
            htmlContent += `<div class="card col-md-4" style="width: 18rem;">`

            switch (true) {
                case elem.IsDir:
                    htmlContent += `<a href="/home${currentPath}/${elem.Name}"><input type="image" src="/static/directory.png" class="card-img-top" alt="diretory"></a>`
                    break;
                case elem.Type.includes("zip") || elem.Type.includes('compressed'):
                    htmlContent += `<img src="/static/zip.png" class="card-img-top" alt="image">`
                    break;
                case elem.Type.includes('pdf'):
                    htmlContent += `<img src="/static/pdf.png" class="card-img-top" alt="image">`
                    break;
                case elem.Type.includes('html'):
                    htmlContent += `<img src="/static/html.png" class="card-img-top" alt="image">`
                    break;
                case elem.Type.includes('xml'):
                    htmlContent += `<img src="/static/xml.png" class="card-img-top" alt="image">`
                    break;
                case elem.Type.includes('image') && elem.ImageData !== null:
                    htmlContent += `<img src="data:image/jpeg;base64,${elem.ImageData}" class="card-img-top" alt="image">`
                    break;
                case elem.Type.includes('image'):
                    htmlContent += `<img src="/static/image.png" class="card-img-top" alt="image">`
                    break;
                default:
                    htmlContent += `<img src="/static/file.png" class="card-img-top" alt="image">`
                    break;
            }

            htmlContent += `<div class="card-body">
                                <h5 class="card-title">${elem.Name}</h5>
                                <p class="card-text">${elem.Size / 1024 / 1024} MB</p>
                                <div class="dropdown menu-dropdown">
                                  <img style="width: 4rem;" class="dropdown-toggle btn" src="/static/menu.png" data-bs-toggle="dropdown" aria-expanded="false">
                                  <ul class="dropdown-menu">
                                    <li>
                                        <a class="btn" href="/delete/${currentPath}/${elem.Name}">Delete</a>
                                    </li>
                                    <li>
                                        <a class="btn" href="/file/${currentPath}/${elem.Name}" target="_blank">Download</a>
                                    </li>
                                    <li>
                                      <button type="button" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#exampleModal">
                                        Rename
                                      </button>
                                    </li>
                                    <li>
                                      <button type="button" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#exampleModal">
                                        Move to
                                      </button>
                                    </li>
                                  </ul>
                                </div>
                              </div>`

            htmlContent += `</div>`
        }
        root.innerHTML = htmlContent;
    }

    filter.addEventListener('input', function (e) {
        displayFiles(true, select.value);
    });
    select.addEventListener("change", function(e) {
        displayFiles(true, select.value);
    });

</script>
{{end}}